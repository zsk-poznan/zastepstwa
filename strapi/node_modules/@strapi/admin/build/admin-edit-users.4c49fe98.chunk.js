"use strict";(self.webpackChunk_strapi_admin=self.webpackChunk_strapi_admin||[]).push([[4263],{28976:(J,_,e)=>{e.r(_),e.d(_,{default:()=>Se});var t=e(32735),s=e(10938),m=e(5141),O=e(92891),W=e(79613),p=e(93587),I=e.n(p),f=e(5636),T=e(60216),P=e.n(T),C=e(88423),D=e.n(C),k=e(33795),N=e.n(k),x=e(9086),G=e.n(x),H=e(84968),w=e(83281),U=e(9808),Z=e(44526),y=e(78330),M=e(11856),A=e(95602),b=e(16540),K=e(90662),Y=e(98599),B=e.n(Y),i=e(88677),r=e.n(i),o=e(81430),ee=e(81999),te=(n,l,a)=>new Promise((d,u)=>{var h=c=>{try{S(a.next(c))}catch(g){u(g)}},v=c=>{try{S(a.throw(c))}catch(g){u(g)}},S=c=>c.done?d(c.value):Promise.resolve(c.value).then(h,v);S((a=a.apply(n,l)).next())});const V=n=>te(void 0,null,function*(){const{data:l}=yield ee.be.get(`/admin/users/${n}`);return l.data}),Pe=(n,l)=>te(void 0,null,function*(){const{data:a}=yield ee.be.put(`/admin/users/${n}`,l);return a.data}),ye=[[{intlLabel:{id:"Auth.form.firstname.label",defaultMessage:"First name"},name:"firstname",placeholder:{id:"Auth.form.firstname.placeholder",defaultMessage:"e.g. Kai"},type:"text",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.lastname.label",defaultMessage:"Last name"},name:"lastname",placeholder:{id:"Auth.form.lastname.placeholder",defaultMessage:"e.g. Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"Auth.form.email.label",defaultMessage:"Email"},name:"email",placeholder:{id:"Auth.form.email.placeholder",defaultMessage:"e.g. kai.doe@strapi.io"},type:"email",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.username.label",defaultMessage:"Username"},name:"username",placeholder:{id:"Auth.form.username.placeholder",defaultMessage:"e.g. Kai_Doe"},type:"email",size:{col:6,xs:12}}],[{intlLabel:{id:"global.password",defaultMessage:"Password"},name:"password",type:"password",size:{col:6,xs:12}},{intlLabel:{id:"Auth.form.confirmPassword.label",defaultMessage:"Password confirmation"},name:"confirmPassword",type:"password",size:{col:6,xs:12}}],[{intlLabel:{id:"Auth.form.active.label",defaultMessage:"Active"},name:"isActive",type:"bool",size:{col:6,xs:12}}]];var Me=e(99063),he=e(58535),Oe=e(98399),_e=void 0;function De(n,l){var a=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!a){if(Array.isArray(n)||(a=Ae(n))||l&&n&&typeof n.length=="number"){a&&(n=a);var d=0,u=function(){};return{s:u,n:function(){return d>=n.length?{done:!0}:{done:!1,value:n[d++]}},e:function(g){throw g},f:u}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var h=!0,v=!1,S;return{s:function(){a=a.call(n)},n:function(){var g=a.next();return h=g.done,g},e:function(g){v=!0,S=g},f:function(){try{!h&&a.return!=null&&a.return()}finally{if(v)throw S}}}}function Ae(n,l){if(!!n){if(typeof n=="string")return se(n,l);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return se(n,l)}}function se(n,l){(l==null||l>n.length)&&(l=n.length);for(var a=0,d=new Array(l);a<l;a++)d[a]=n[a];return d}var Le=Object.defineProperty,Ie=Object.defineProperties,Te=Object.getOwnPropertyDescriptors,oe=Object.getOwnPropertySymbols,Ce=Object.prototype.hasOwnProperty,Ue=Object.prototype.propertyIsEnumerable,le=function(l,a,d){return a in l?Le(l,a,{enumerable:!0,configurable:!0,writable:!0,value:d}):l[a]=d},ie=function(l,a){for(var d in a||(a={}))Ce.call(a,d)&&le(l,d,a[d]);if(oe){var u=De(oe(a)),h;try{for(u.s();!(h=u.n()).done;){var d=h.value;Ue.call(a,d)&&le(l,d,a[d])}}catch(v){u.e(v)}finally{u.f()}}return l},Be=function(l,a){return Ie(l,Te(a))},Re=function(l,a,d){return new Promise(function(u,h){var v=function(j){try{c(d.next(j))}catch(X){h(X)}},S=function(j){try{c(d.throw(j))}catch(X){h(X)}},c=function(j){return j.done?u(j.value):Promise.resolve(j.value).then(v,S)};c((d=d.apply(l,a)).next())})},We=function(){return window&&window.strapi&&window.strapi.isEE?e(80515).Z:e(83396).Z}(),de=["email","firstname","lastname","username","isActive","roles"],ue=function(l){var a=l.canUpdate,d=(0,f.useIntl)(),u=d.formatMessage,h=(0,m.useRouteMatch)("/settings/users/:id"),v=h.params.id,S=(0,m.useHistory)(),c=S.push,g=(0,s.useAppInfos)(),j=g.setUserDisplayName,X=(0,s.useNotification)(),ce=(0,s.useOverlayBlocker)(),Ze=ce.lockApp,be=ce.unlockApp;(0,s.useFocusWhenNavigate)();var me=(0,H.useQuery)(["user",v],function(){return V(v)},{retry:!1,keepPreviousData:!1,staleTime:1e3*20,onError:function(E){var z=E.response.status;z===403&&(X({type:"info",message:{id:"notification.permission.not-allowed-read",defaultMessage:"You are not allowed to see this document"}}),c("/")),Oe.log(E.response.status)}}),je=me.status,$=me.data,ze=function(E,z){return Re(_e,null,I().mark(function Q(){var q,re,F,ne,Ee;return I().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return Ze(),L.prev=1,L.next=4,Pe(v,G()(E,"confirmPassword"));case 4:q=L.sent,X({type:"success",message:u({id:"notification.success.saved",defaultMessage:"Saved"})}),re=s.auth.getUserInfo(),v.toString()===re.id.toString()&&(s.auth.setUserInfo(q),F=N()(E,"username")||(0,o.Pp)(E.firstname,E.lastname),j(F)),z.setValues(D()(E,de)),L.next=17;break;case 11:L.prev=11,L.t0=L.catch(1),ne=(0,o.Iz)(L.t0.response.data),Ee=Object.keys(ne).reduce(function(ve,ge){return ve[ge]=ne[ge].id,ve},{}),z.setErrors(Ee),X({type:"warning",message:N()(L.t0,"response.data.message","notification.error")});case 17:be();case 18:case"end":return L.stop()}},Q,null,[[1,11]])}))},pe=je!=="success",Ne=pe?{id:"app.containers.Users.EditPage.header.label-loading",defaultMessage:"Edit user"}:{id:"app.containers.Users.EditPage.header.label",defaultMessage:"Edit {name}"},ae=Object.keys(D()($,de)).reduce(function(R,E){return E==="roles"?(R[E]=(($==null?void 0:$.roles)||[]).map(function(z){var Q=z.id;return Q}),R):(R[E]=$==null?void 0:$[E],R)},{}),we=ae.username||(0,o.Pp)(ae.firstname,ae.lastname),fe=u(Ne,{name:we});return pe?t.createElement(b.Main,{"aria-busy":"true"},t.createElement(s.SettingsPageTitle,{name:"Users"}),t.createElement(M.HeaderLayout,{primaryAction:t.createElement(Z.Button,{disabled:!0,startIcon:t.createElement(r(),null),type:"button",size:"L"},u({id:"global.save",defaultMessage:"Save"})),title:fe,navigationAction:t.createElement(s.Link,{startIcon:t.createElement(B(),null),to:"/settings/users?pageSize=10&page=1&sort=firstname"},u({id:"global.back",defaultMessage:"Back"}))}),t.createElement(M.ContentLayout,null,t.createElement(s.LoadingIndicatorPage,null))):t.createElement(b.Main,null,t.createElement(s.SettingsPageTitle,{name:"Users"}),t.createElement(w.Formik,{onSubmit:ze,initialValues:ae,validateOnChange:!1,validationSchema:Me.YM},function(R){var E=R.errors,z=R.values,Q=R.handleChange,q=R.isSubmitting;return t.createElement(s.Form,null,t.createElement(M.HeaderLayout,{primaryAction:t.createElement(Z.Button,{disabled:q||!a,startIcon:t.createElement(r(),null),loading:q,type:"submit",size:"L"},u({id:"global.save",defaultMessage:"Save"})),title:fe,navigationAction:t.createElement(s.Link,{startIcon:t.createElement(B(),null),to:"/settings/users?pageSize=10&page=1&sort=firstname"},u({id:"global.back",defaultMessage:"Back"}))}),t.createElement(M.ContentLayout,null,($==null?void 0:$.registrationToken)&&t.createElement(U.Box,{paddingBottom:6},t.createElement(We,{registrationToken:$.registrationToken})),t.createElement(K.Stack,{spacing:7},t.createElement(U.Box,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},t.createElement(K.Stack,{spacing:4},t.createElement(A.Typography,{variant:"delta",as:"h2"},u({id:"app.components.Users.ModalCreateBody.block-title.details",defaultMessage:"Details"})),t.createElement(y.Grid,{gap:5},ye.map(function(re){return re.map(function(F){return t.createElement(y.GridItem,ie({key:F.name},F.size),t.createElement(s.GenericInput,Be(ie({},F),{disabled:!a,error:E[F.name],onChange:Q,value:z[F.name]||""})))})})))),t.createElement(U.Box,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},t.createElement(K.Stack,{spacing:4},t.createElement(A.Typography,{variant:"delta",as:"h2"},u({id:"global.roles",defaultMessage:"User's role"})),t.createElement(y.Grid,{gap:5},t.createElement(y.GridItem,{col:6,xs:12},t.createElement(he.Z,{disabled:!a,error:E.roles,onChange:Q,value:z.roles}))))))))}))};ue.propTypes={canUpdate:P().bool.isRequired};const Ke=ue,Se=()=>{const n=(0,s.useNotification)(),l=(0,t.useMemo)(()=>({read:W.Z.settings.users.read,update:W.Z.settings.users.update}),[]),{isLoading:a,allowedActions:{canRead:d,canUpdate:u}}=(0,s.useRBAC)(l),{state:h}=(0,m.useLocation)(),v=(0,O.get)(h,"from","/");return(0,t.useEffect)(()=>{a||!d&&!u&&n({type:"info",message:{id:"notification.permission.not-allowed-read",defaultMessage:"You are not allowed to see this document"}})},[a,d,u,n]),a?t.createElement(s.LoadingIndicatorPage,null):!d&&!u?t.createElement(m.Redirect,{to:v}):t.createElement(Ke,{canUpdate:u})}},98924:(J,_,e)=>{e.d(_,{Z:()=>G});var t=e(32735),s=e(60216),m=e.n(s),O=e(20763),W=e.n(O),p=e(10938),I=e.n(p),f=e(68192),T=e.n(f),P=e(59087),C=e.n(P),D=e(5636),k=e.n(D);const N=()=>t.createElement("svg",{xmlns:"http://www.w3.org/2000/svg"},t.createElement("text",{transform:"translate(-23 -9)",fill:"#4B515A",fillRule:"evenodd",fontSize:"32",fontFamily:"AppleColorEmoji, Apple Color Emoji"},t.createElement("tspan",{x:"23",y:"36"},"\u2709\uFE0F"))),x=({children:H,target:w})=>{const U=(0,p.useNotification)(),{formatMessage:Z}=(0,D.useIntl)(),y=()=>{U({type:"info",message:{id:"notification.link-copied"}})},M=Z({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"});return t.createElement(p.ContentBox,{endAction:t.createElement(P.CopyToClipboard,{onCopy:y,text:w},t.createElement(O.IconButton,{label:M,noBorder:!0,icon:t.createElement(T(),null)})),title:w,titleEllipsis:!0,subtitle:H,icon:t.createElement(N,null),iconBackground:"neutral100"})};x.propTypes={children:m().oneOfType([m().element,m().string]).isRequired,target:m().string.isRequired};const G=x},83396:(J,_,e)=>{e.d(_,{Z:()=>T});var t=e(32735),s=e(5636),m=e.n(s),O=e(60216),W=e.n(O),p=e(6630),I=e(98924);const f=({registrationToken:P})=>{const{formatMessage:C}=(0,s.useIntl)(),D=`${window.location.origin}${p.Z}auth/register?registrationToken=${P}`;return t.createElement(I.Z,{target:D},C({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"}))};f.defaultProps={registrationToken:""},f.propTypes={registrationToken:W().string};const T=f},58535:(J,_,e)=>{e.d(_,{Z:()=>Z});var t=e(32735),s=e(60216),m=e.n(s),O=e(5636),W=e.n(O),p=e(25716),I=e.n(p),f=e(84968),T=e.n(f),P=e(19615),C=e(103),D=e.n(C),k=e(81999),N=(y,M,A)=>new Promise((b,K)=>{var Y=r=>{try{i(A.next(r))}catch(o){K(o)}},B=r=>{try{i(A.throw(r))}catch(o){K(o)}},i=r=>r.done?b(r.value):Promise.resolve(r.value).then(Y,B);i((A=A.apply(y,M)).next())});const x=P.keyframes`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(359deg);
  }
`,G=P.default.div`
  animation: ${x} 2s infinite linear;
`,H=()=>t.createElement(G,null,t.createElement(D(),null)),w=()=>N(void 0,null,function*(){const{data:y}=yield k.be.get("/admin/roles");return y.data}),U=({disabled:y,error:M,onChange:A,value:b})=>{const{status:K,data:Y}=(0,f.useQuery)(["roles"],w,{staleTime:5e4}),{formatMessage:B}=(0,O.useIntl)(),i=M?B({id:M,defaultMessage:M}):"",r=B({id:"app.components.Users.ModalCreateBody.block-title.roles",defaultMessage:"User's roles"}),o=B({id:"app.components.Users.ModalCreateBody.block-title.roles.description",defaultMessage:"A user can have one or several roles"}),ee=B({id:"app.components.Select.placeholder",defaultMessage:"Select"}),te=K==="loading"?t.createElement(H,null):void 0;return t.createElement(p.Select,{id:"roles",disabled:y,error:i,hint:o,label:r,name:"roles",onChange:V=>{A({target:{name:"roles",value:V}})},placeholder:ee,multi:!0,startIcon:te,value:b,withTags:!0,required:!0},(Y||[]).map(V=>t.createElement(p.Option,{key:V.id,value:V.id},V.name)))};U.defaultProps={disabled:!1,error:void 0},U.propTypes={disabled:m().bool,error:m().string,onChange:m().func.isRequired,value:m().array.isRequired};const Z=U},99063:(J,_,e)=>{e.d(_,{YM:()=>B,Rw:()=>N});var t=e(5173),s=e(10938),m=Object.defineProperty,O=Object.defineProperties,W=Object.getOwnPropertyDescriptors,p=Object.getOwnPropertySymbols,I=Object.prototype.hasOwnProperty,f=Object.prototype.propertyIsEnumerable,T=(i,r,o)=>r in i?m(i,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):i[r]=o,P=(i,r)=>{for(var o in r||(r={}))I.call(r,o)&&T(i,o,r[o]);if(p)for(var o of p(r))f.call(r,o)&&T(i,o,r[o]);return i},C=(i,r)=>O(i,W(r));const D={firstname:t.nK().required(s.translatedErrors.required),lastname:t.nK(),email:t.Z_().email(s.translatedErrors.email).lowercase().required(s.translatedErrors.required),username:t.Z_().nullable(),password:t.Z_().min(8,s.translatedErrors.minLength).matches(/[a-z]/,"components.Input.error.contain.lowercase").matches(/[A-Z]/,"components.Input.error.contain.uppercase").matches(/\d/,"components.Input.error.contain.number"),confirmPassword:t.Z_().min(8,s.translatedErrors.minLength).oneOf([t.iH("password"),null],"components.Input.error.password.noMatch").when("password",(i,r)=>i?r.required(s.translatedErrors.required):r)},N=C(P({},D),{currentPassword:t.Z_().when(["password","confirmPassword"],(i,r,o)=>i||r?o.required(s.translatedErrors.required):o),preferedLanguage:t.Z_().nullable()}),G={roles:t.IX().min(1,s.translatedErrors.required).required(s.translatedErrors.required)};var H=Object.defineProperty,w=Object.defineProperties,U=Object.getOwnPropertyDescriptors,Z=Object.getOwnPropertySymbols,y=Object.prototype.hasOwnProperty,M=Object.prototype.propertyIsEnumerable,A=(i,r,o)=>r in i?H(i,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):i[r]=o,b=(i,r)=>{for(var o in r||(r={}))y.call(r,o)&&A(i,o,r[o]);if(Z)for(var o of Z(r))M.call(r,o)&&A(i,o,r[o]);return i},K=(i,r)=>w(i,U(r));const B=t.Ry().shape(b(K(b({},D),{isActive:t.Xg()}),G))},80515:(J,_,e)=>{e.d(_,{Z:()=>T});var t=e(32735),s=e(5636),m=e.n(s),O=e(60216),W=e.n(O),p=e(6630),I=e(98924);const f=({registrationToken:P})=>{const{formatMessage:C}=(0,s.useIntl)();return P?t.createElement(I.Z,{target:`${window.location.origin}${p.Z}auth/register?registrationToken=${P}`},C({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"})):t.createElement(I.Z,{target:`${window.location.origin}${p.Z}auth/login`},C({id:"app.components.Users.MagicLink.connect.sso",defaultMessage:"Send this link to the user, the first login can be made via a SSO provider."}))};f.defaultProps={registrationToken:""},f.propTypes={registrationToken:W().string};const T=f}}]);
