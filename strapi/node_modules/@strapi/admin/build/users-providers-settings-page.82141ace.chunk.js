"use strict";(self.webpackChunk_strapi_admin=self.webpackChunk_strapi_admin||[]).push([[2282],{36455:(ee,S,n)=>{n.r(S),n.d(S,{ProvidersPage:()=>he,default:()=>Ke});var e=n(32735),R=n(5636),i=n(10938),j=n(23973),Z=n.n(j),I=n(23940),w=n.n(I),f=n(16925),y=n(11856),E=n(16540),F=n(29270),u=n(53214),b=n(95602),B=n(28004),T=n(20763),L=n(95717),x=n.n(L),W=n(84968),o=n(5173),c=n(13810);const te={id:(0,c.OB)("PopUpForm.Providers.redirectURL.front-end.label"),defaultMessage:"The redirect URL to your front-end app"},re={id:"http://www.client-app.com",defaultMessage:"http://www.client-app.com"},H={id:(0,c.OB)("PopUpForm.Providers.enabled.description"),defaultMessage:"If disabled, users won't be able to use this provider."},V={id:(0,c.OB)("PopUpForm.Providers.enabled.label"),defaultMessage:"Enable"},ae={id:(0,c.OB)("PopUpForm.Providers.key.label"),defaultMessage:"Client ID"},ne={id:(0,c.OB)("PopUpForm.Providers.redirectURL.label"),defaultMessage:"The redirect URL to add in your {provider} application configurations"},A={id:(0,c.OB)("PopUpForm.Providers.key.placeholder"),defaultMessage:"TEXT"},se={id:(0,c.OB)("PopUpForm.Providers.secret.label"),defaultMessage:"Client Secret"},G={email:{form:[[{intlLabel:V,name:"enabled",type:"bool",description:H,size:6}]],schema:o.Ry().shape({enabled:o.Xg().required(i.translatedErrors.required)})},providers:{form:[[{intlLabel:V,name:"enabled",type:"bool",description:H,size:6,validations:{required:!0}}],[{intlLabel:ae,name:"key",type:"text",placeholder:A,size:12,validations:{required:!0}}],[{intlLabel:se,name:"secret",type:"text",placeholder:A,size:12,validations:{required:!0}}],[{intlLabel:te,placeholder:re,name:"callback",type:"text",size:12,validations:{required:!0}}],[{intlLabel:ne,name:"noName",type:"text",validations:{},size:12,disabled:!0}]],schema:o.Ry().shape({enabled:o.Xg().required(i.translatedErrors.required),key:o.Z_().when("enabled",{is:!0,then:o.Z_().required(i.translatedErrors.required),otherwise:o.Z_()}),secret:o.Z_().when("enabled",{is:!0,then:o.Z_().required(i.translatedErrors.required),otherwise:o.Z_()}),callback:o.Z_().when("enabled",{is:!0,then:o.Z_().required(i.translatedErrors.required),otherwise:o.Z_()})})},providersWithSubdomain:{form:[[{intlLabel:V,name:"enabled",type:"bool",description:H,size:6,validations:{required:!0}}],[{intlLabel:ae,name:"key",type:"text",placeholder:A,size:12,validations:{required:!0}}],[{intlLabel:se,name:"secret",type:"text",placeholder:A,size:12,validations:{required:!0}}],[{intlLabel:{id:(0,c.OB)("PopUpForm.Providers.subdomain.label"),defaultMessage:"Host URI (Subdomain)"},name:"subdomain",type:"text",placeholder:{id:(0,c.OB)("PopUpForm.Providers.subdomain.placeholder"),defaultMessage:"my.subdomain.com"},size:12,validations:{required:!0}}],[{intlLabel:te,placeholder:re,name:"callback",type:"text",size:12,validations:{required:!0}}],[{intlLabel:ne,name:"noName",type:"text",validations:{},size:12,disabled:!0}]],schema:o.Ry().shape({enabled:o.Xg().required(i.translatedErrors.required),key:o.Z_().when("enabled",{is:!0,then:o.Z_().required(i.translatedErrors.required),otherwise:o.Z_()}),secret:o.Z_().when("enabled",{is:!0,then:o.Z_().required(i.translatedErrors.required),otherwise:o.Z_()}),subdomain:o.Z_().when("enabled",{is:!0,then:o.Z_().required(i.translatedErrors.required),otherwise:o.Z_()}),callback:o.Z_().when("enabled",{is:!0,then:o.Z_().required(i.translatedErrors.required),otherwise:o.Z_()})})}};var be=(t,r,a)=>new Promise((g,m)=>{var P=d=>{try{h(a.next(d))}catch(l){m(l)}},p=d=>{try{h(a.throw(d))}catch(l){m(l)}},h=d=>d.done?g(d.value):Promise.resolve(d.value).then(P,p);h((a=a.apply(t,r)).next())});const Ee=t=>be(void 0,null,function*(){try{const{data:r}=yield c.be.get((0,c.Gc)("providers"));return r}catch(r){throw t({type:"warning",message:{id:"notification.error"}}),new Error("error")}}),Oe=t=>c.be.put((0,c.Gc)("providers"),t);var Me=n(92891);const Te=t=>(0,Me.sortBy)(Object.keys(t).reduce((r,a)=>{const{icon:g,enabled:m,subdomain:P}=t[a],p=g==="envelope"?["fas","envelope"]:["fab",g];return P!==void 0?r.push({name:a,icon:p,enabled:m,subdomain:P}):r.push({name:a,icon:p,enabled:m}),r},[]),"name");var oe=n(13087),le=n(44526),Le=n(90662),ie=n(71657),de=n(78330),N=n(4122),Re=n(60216),s=n.n(Re),Be=n(83281),Ce=n(63865),Se=n(37178),Ie=Object.defineProperty,ue=Object.getOwnPropertySymbols,Fe=Object.prototype.hasOwnProperty,Ue=Object.prototype.propertyIsEnumerable,ce=(t,r,a)=>r in t?Ie(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a,X=(t,r)=>{for(var a in r||(r={}))Fe.call(r,a)&&ce(t,a,r[a]);if(ue)for(var a of ue(r))Ue.call(r,a)&&ce(t,a,r[a]);return t};const $=({description:t,disabled:r,intlLabel:a,error:g,name:m,onChange:P,placeholder:p,providerToEditName:h,type:d,value:l})=>{const{formatMessage:O}=(0,R.useIntl)(),C=m==="noName"?`${strapi.backendURL}/api/connect/${h}/callback`:l,U=O({id:a.id,defaultMessage:a.defaultMessage},X({provider:h},a.values)),M=t?O({id:t.id,defaultMessage:t.defaultMessage},X({provider:h},t.values)):"";if(d==="bool")return e.createElement(Ce.ToggleInput,{"aria-label":m,checked:l,disabled:r,hint:M,label:U,name:m,offLabel:O({id:"app.components.ToggleCheckbox.off-label",defaultMessage:"Off"}),onLabel:O({id:"app.components.ToggleCheckbox.on-label",defaultMessage:"On"}),onChange:D=>{P({target:{name:m,value:D.target.checked}})}});const k=p?O({id:p.id,defaultMessage:p.defaultMessage},X({},p.values)):"",Y=g?O({id:g,defaultMessage:g}):"";return e.createElement(Se.TextInput,{"aria-label":m,disabled:r,error:Y,label:U,name:m,onChange:P,placeholder:k,type:d,value:C})};$.defaultProps={description:null,disabled:!1,error:"",placeholder:null,value:""},$.propTypes={description:s().shape({id:s().string.isRequired,defaultMessage:s().string.isRequired,values:s().object}),disabled:s().bool,error:s().string,intlLabel:s().shape({id:s().string.isRequired,defaultMessage:s().string.isRequired,values:s().object}).isRequired,name:s().string.isRequired,onChange:s().func.isRequired,placeholder:s().shape({id:s().string.isRequired,defaultMessage:s().string.isRequired,values:s().object}),providerToEditName:s().string.isRequired,type:s().string.isRequired,value:s().oneOfType([s().bool,s().string])};const Ze=$;var we=Object.defineProperty,xe=Object.defineProperties,De=Object.getOwnPropertyDescriptors,me=Object.getOwnPropertySymbols,je=Object.prototype.hasOwnProperty,Ae=Object.prototype.propertyIsEnumerable,pe=(t,r,a)=>r in t?we(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a,Ne=(t,r)=>{for(var a in r||(r={}))je.call(r,a)&&pe(t,a,r[a]);if(me)for(var a of me(r))Ae.call(r,a)&&pe(t,a,r[a]);return t},ze=(t,r)=>xe(t,De(r));const K=({headerBreadcrumbs:t,initialData:r,isSubmiting:a,layout:g,isOpen:m,onSubmit:P,onToggle:p,providerToEditName:h})=>{const{formatMessage:d}=(0,R.useIntl)();return m?e.createElement(N.ModalLayout,{onClose:p,labelledBy:"title"},e.createElement(N.ModalHeader,null,e.createElement(ie.Breadcrumbs,{label:t.join(", ")},t.map(l=>e.createElement(ie.Crumb,{key:l},l)))),e.createElement(Be.Formik,{onSubmit:l=>P(l),initialValues:r,validationSchema:g.schema,validateOnChange:!1},({errors:l,handleChange:O,values:C})=>e.createElement(i.Form,null,e.createElement(N.ModalBody,null,e.createElement(Le.Stack,{spacing:1},e.createElement(de.Grid,{gap:5},g.form.map(U=>U.map(M=>e.createElement(de.GridItem,{key:M.name,col:M.size,xs:12},e.createElement(Ze,ze(Ne({},M),{error:l[M.name],onChange:O,value:C[M.name],providerToEditName:h})))))))),e.createElement(N.ModalFooter,{startActions:e.createElement(le.Button,{variant:"tertiary",onClick:p,type:"button"},d({id:"app.components.Button.cancel",defaultMessage:"Cancel"})),endActions:e.createElement(e.Fragment,null,e.createElement(le.Button,{type:"submit",loading:a},d({id:"global.save",defaultMessage:"Save"})))})))):null};K.defaultProps={initialData:null,providerToEditName:null},K.propTypes={headerBreadcrumbs:s().arrayOf(s().string).isRequired,initialData:s().object,layout:s().shape({form:s().arrayOf(s().array),schema:s().object}).isRequired,isOpen:s().bool.isRequired,isSubmiting:s().bool.isRequired,onSubmit:s().func.isRequired,onToggle:s().func.isRequired,providerToEditName:s().string};const qe=K;var We=Object.defineProperty,He=Object.defineProperties,Ve=Object.getOwnPropertyDescriptors,ve=Object.getOwnPropertySymbols,Ge=Object.prototype.hasOwnProperty,Xe=Object.prototype.propertyIsEnumerable,fe=(t,r,a)=>r in t?We(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a,Q=(t,r)=>{for(var a in r||(r={}))Ge.call(r,a)&&fe(t,a,r[a]);if(ve)for(var a of ve(r))Xe.call(r,a)&&fe(t,a,r[a]);return t},$e=(t,r)=>He(t,Ve(r)),ge=(t,r,a)=>new Promise((g,m)=>{var P=d=>{try{h(a.next(d))}catch(l){m(l)}},p=d=>{try{h(a.throw(d))}catch(l){m(l)}},h=d=>d.done?g(d.value):Promise.resolve(d.value).then(P,p);h((a=a.apply(t,r)).next())});const he=()=>{const{formatMessage:t}=(0,R.useIntl)();(0,i.useFocusWhenNavigate)();const{notifyStatus:r}=(0,F.useNotifyAT)(),a=(0,W.useQueryClient)(),{trackUsage:g}=(0,i.useTracking)(),m=(0,e.useRef)(g),[P,p]=(0,e.useState)(!1),[h,d]=(0,e.useState)(!1),[l,O]=(0,e.useState)(null),C=(0,i.useNotification)(),{lockApp:U,unlockApp:M}=(0,i.useOverlayBlocker)(),k=(0,e.useMemo)(()=>({update:oe.Z.updateProviders}),[]),{isLoading:Y,allowedActions:{canUpdate:D}}=(0,i.useRBAC)(k),{isLoading:Qe,data:z,isFetching:ke}=(0,W.useQuery)("get-providers",()=>Ee(C),{onSuccess:()=>{r(t({id:(0,c.OB)("Providers.data.loaded"),defaultMessage:"Providers have been loaded"}))},initialData:{}}),Ye=Qe||ke,Je=(0,W.useMutation)(Oe,{onSuccess:()=>ge(void 0,null,function*(){yield a.invalidateQueries("get-providers"),C({type:"info",message:{id:(0,c.OB)("notification.success.submit")}}),m.current("didEditAuthenticationProvider"),d(!1),J(),M()}),onError:()=>{C({type:"warning",message:{id:"notification.error"}}),M(),d(!1)},refetchActive:!1}),q=(0,e.useMemo)(()=>Te(z),[z]),_e=q.length,ye=(0,e.useMemo)(()=>{if(!l)return!1;const v=q.find(_=>_.name===l);return Z()(v,"subdomain")},[q,l]),et=t({id:(0,c.OB)("HeaderNav.link.providers"),defaultMessage:"Providers"}),tt=(0,e.useMemo)(()=>l==="email"?G.email:ye?G.providersWithSubdomain:G.providers,[l,ye]),J=()=>{p(v=>!v)},Pe=v=>{D&&(O(v.name),J())},rt=v=>ge(void 0,null,function*(){d(!0),U(),m.current("willEditAuthenticationProvider");const _=$e(Q({},z),{[l]:v});Je.mutate({providers:_})});return e.createElement(y.Layout,null,e.createElement(i.SettingsPageTitle,{name:et}),e.createElement(E.Main,null,e.createElement(y.HeaderLayout,{title:t({id:(0,c.OB)("HeaderNav.link.providers"),defaultMessage:"Providers"})}),Ye||Y?e.createElement(i.LoadingIndicatorPage,null):e.createElement(y.ContentLayout,null,e.createElement(u.Table,{colCount:4,rowCount:_e+1},e.createElement(u.Thead,null,e.createElement(u.Tr,null,e.createElement(u.Th,null,e.createElement(b.Typography,{variant:"sigma",textColor:"neutral600"},e.createElement(B.VisuallyHidden,null,t({id:(0,c.OB)("Providers.image"),defaultMessage:"Image"})))),e.createElement(u.Th,null,e.createElement(b.Typography,{variant:"sigma",textColor:"neutral600"},t({id:"global.name",defaultMessage:"Name"}))),e.createElement(u.Th,null,e.createElement(b.Typography,{variant:"sigma",textColor:"neutral600"},t({id:(0,c.OB)("Providers.status"),defaultMessage:"Status"}))),e.createElement(u.Th,null,e.createElement(b.Typography,{variant:"sigma"},e.createElement(B.VisuallyHidden,null,t({id:"global.settings",defaultMessage:"Settings"})))))),e.createElement(u.Tbody,null,q.map(v=>e.createElement(u.Tr,Q({key:v.name},(0,i.onRowClick)({fn:()=>Pe(v),condition:D})),e.createElement(u.Td,{width:""},e.createElement(f.G,{icon:v.icon})),e.createElement(u.Td,{width:"45%"},e.createElement(b.Typography,{fontWeight:"semiBold",textColor:"neutral800"},v.name)),e.createElement(u.Td,{width:"65%"},e.createElement(b.Typography,{textColor:v.enabled?"success600":"danger600","data-testid":`enable-${v.name}`},v.enabled?t({id:"global.enabled",defaultMessage:"Enabled"}):t({id:"global.disabled",defaultMessage:"Disabled"}))),e.createElement(u.Td,Q({},i.stopPropagation),D&&e.createElement(T.IconButton,{onClick:()=>Pe(v),noBorder:!0,icon:e.createElement(x(),null),label:"Edit"})))))))),e.createElement(qe,{initialData:z[l],isOpen:P,isSubmiting:h,layout:tt,headerBreadcrumbs:[t({id:(0,c.OB)("PopUpForm.header.edit.providers"),defaultMessage:"Edit Provider"}),w()(l)],onToggle:J,onSubmit:rt,providerToEditName:l}))},Ke=()=>e.createElement(i.CheckPagePermissions,{permissions:oe.Z.readProviders},e.createElement(he,null))},54080:(ee,S,n)=>{n.d(S,{Z:()=>w});var e=n(43653),R=n.n(e),i=n(10938),j=n.n(i),Z=(f,y,E)=>new Promise((F,u)=>{var b=L=>{try{T(E.next(L))}catch(x){u(x)}},B=L=>{try{T(E.throw(L))}catch(x){u(x)}},T=L=>L.done?F(L.value):Promise.resolve(L.value).then(b,B);T((E=E.apply(f,y)).next())});const I=R().create({baseURL:"http://localhost:1337"});I.interceptors.request.use(f=>Z(void 0,null,function*(){return f.headers={Authorization:`Bearer ${i.auth.getToken()}`,Accept:"application/json","Content-Type":"application/json"},f}),f=>{Promise.reject(f)}),I.interceptors.response.use(f=>f,f=>{var y;throw((y=f.response)==null?void 0:y.status)===401&&(i.auth.clearAppStorage(),window.location.reload()),f});const w=I},13810:(ee,S,n)=>{n.d(S,{be:()=>e.Z,YX:()=>j,Gc:()=>w,OB:()=>f.Z});var e=n(54080),R=n(92891);const j=y=>Object.keys(y).reduce((E,F)=>{const u=y[F].controllers,b=Object.keys(u).reduce((B,T)=>((0,R.isEmpty)(u[T])||(B[T]=u[T]),B),{});return(0,R.isEmpty)(b)||(E[F]={controllers:b}),E},{});var Z=n(46354);const w=y=>`/${Z.Z}/${y}`;var f=n(39650)}}]);
